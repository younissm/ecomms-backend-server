import{j as t,r as X,K as pt,ac as mt,C as gt,S as He,ad as we,B as ht,F as ft,T as M,ae as xt,x as J,U as bt,Z as Ie,aa as yt,ab as jt,af as Ct}from"./index-B-wAYjFk.js";import{u as Z}from"./useQuery-BQEVoXP1.js";import{B as _}from"./chunk-PULVB27S-Ch_R_y_s.js";import{S as Te}from"./chunk-GOJLRND4-Cb4C_z-b.js";import{S as q}from"./chunk-IYS4KVU2-DhSEwTdN.js";import{a as Ne,b as Ge,c as Ae,q as K}from"./index-CVf2sffD.js";import{u as St}from"./useMutation-DydnxJgk.js";import{g as kt,c as vt}from"./apiReviews-TrU2k0M4.js";import{g as _t}from"./apiUsers-CTlIbdPv.js";import{u as Vt,F as Pt}from"./index.esm-B6lPUqVX.js";import{T as zt}from"./chunk-4IH3O7BJ-CUbGKQNL.js";import{H as $}from"./chunk-7OLJDQMT-BuJdq_n8.js";import{V as Ee}from"./chunk-NTCQBYKE-DC7wldgN.js";import{F as Rt}from"./chunk-56K2BSAJ-C_Q_2N6z.js";import{a as Lt}from"./apiProduct-DnmNEjyS.js";import{H as Be}from"./chunk-3ASUQ6PA-BebN9-6c.js";import{I as Mt}from"./chunk-QINAG4RG-Crh5SdU4.js";import{I as Q}from"./chunk-6QYXN73V-XiCQhsve.js";import"./chunk-KC77MHL3-Bg1szFpQ.js";import"./chunk-ZHMYA64R-DG8BThpc.js";import"./chunk-SPIKMR6I-DKgwk26N.js";const wt=()=>t.jsxs(_,{bg:"gray.700",p:5,rounded:"",children:[t.jsx(Te,{mt:"4",h:200,rounded:"md",spacing:"4"}),t.jsx(q,{mt:"4",w:20,noOfLines:1,spacing:"4",mx:"auto"}),t.jsx(q,{mt:"4",noOfLines:1,spacing:"4"}),t.jsx(q,{mt:"4",noOfLines:3,spacing:"4"}),t.jsx(q,{mt:"4",noOfLines:1,spacing:"4"}),t.jsx(Te,{mt:"4",h:50,rounded:"md",spacing:"4"})]});var qe={},Ke;Object.defineProperty(qe,"__esModule",{value:!0});var k=t,C=X,u=function(){return u=Object.assign||function(e){for(var n,c=1,s=arguments.length;c<s;c++)for(var r in n=arguments[c])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},u.apply(this,arguments)};function Fe(e,n,c){if(c||arguments.length===2)for(var s,r=0,p=n.length;r<p;r++)!s&&r in n||(s||(s=Array.prototype.slice.call(n,0,r)),s[r]=n[r]);return e.concat(s||Array.prototype.slice.call(n))}function We(e){var n=e.size,c=n===void 0?25:n,s=e.SVGstrokeColor,r=s===void 0?"currentColor":s,p=e.SVGstorkeWidth,m=p===void 0?0:p,V=e.SVGclassName,a=V===void 0?"star-svg":V,h=e.SVGstyle;return k.jsx("svg",u({className:a,style:h,stroke:r,fill:"currentColor",strokeWidth:m,viewBox:"0 0 24 24",width:c,height:c,xmlns:"http://www.w3.org/2000/svg"},{children:k.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})}))}function It(e,n){switch(n.type){case"PointerMove":return u(u({},e),{hoverValue:n.payload,hoverIndex:n.index});case"PointerLeave":return u(u({},e),{ratingValue:e.ratingValue,hoverIndex:0,hoverValue:null});case"MouseClick":return u(u({},e),{valueIndex:e.hoverIndex,ratingValue:n.payload});default:return e}}var Tt="style-module_starRatingWrap__q-lJC",Nt="style-module_simpleStarRating__nWUxf",Gt="style-module_fillIcons__6---A",At="style-module_emptyIcons__Bg-FZ",Bt="style-module_tooltip__tKc3i";function Oe(){return typeof window<"u"&&window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window||typeof navigator<"u"&&navigator.maxTouchPoints>0}(function(e,n){n===void 0&&(n={});var c=n.insertAt;if(e&&typeof document<"u"){var s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",c==="top"&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}})(".style-module_starRatingWrap__q-lJC{display:inline-block;touch-action:none}.style-module_simpleStarRating__nWUxf{display:inline-block;overflow:hidden;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle;white-space:nowrap}.style-module_fillIcons__6---A{display:inline-block;overflow:hidden;position:absolute;top:0;white-space:nowrap}.style-module_emptyIcons__Bg-FZ{display:inline-block}.style-module_tooltip__tKc3i{background-color:#333;border-radius:5px;color:#fff;display:inline-block;padding:5px 15px;vertical-align:middle}"),Ke=qe.Rating=function(e){var n,c,s=e.onClick,r=e.onPointerMove,p=e.onPointerEnter,m=e.onPointerLeave,V=e.initialValue,a=V===void 0?0:V,h=e.iconsCount,o=h===void 0?5:h,g=e.size,v=g===void 0?40:g,F=e.readonly,P=F!==void 0&&F,G=e.rtl,w=G!==void 0&&G,i=e.customIcons,x=i===void 0?[]:i,b=e.allowFraction,d=b!==void 0&&b,y=e.style,z=e.className,I=z===void 0?"react-simple-star-rating":z,A=e.transition,Ue=A!==void 0&&A,Y=e.allowHover,D=Y===void 0||Y,ee=e.disableFillHover,te=ee!==void 0&&ee,oe=e.fillIcon,Je=oe===void 0?null:oe,ie=e.fillColor,Qe=ie===void 0?"#ffbc0b":ie,ne=e.fillColorArray,Xe=ne===void 0?[]:ne,Ze=e.fillStyle,re=e.fillClassName,$e=re===void 0?"filled-icons":re,se=e.emptyIcon,Ye=se===void 0?null:se,ae=e.emptyColor,De=ae===void 0?"#cccccc":ae,et=e.emptyStyle,le=e.emptyClassName,tt=le===void 0?"empty-icons":le,ce=e.allowTitleTag,ot=ce===void 0||ce,de=e.showTooltip,it=de!==void 0&&de,ue=e.tooltipDefaultText,nt=ue===void 0?"Your Rate":ue,pe=e.tooltipArray,W=pe===void 0?[]:pe,rt=e.tooltipStyle,me=e.tooltipClassName,st=me===void 0?"react-simple-star-rating-tooltip":me,ge=e.SVGclassName,he=ge===void 0?"star-svg":ge,fe=e.titleSeparator,at=fe===void 0?"out of":fe,xe=e.SVGstyle,be=e.SVGstorkeWidth,ye=be===void 0?0:be,je=e.SVGstrokeColor,Ce=je===void 0?"currentColor":je,Se=C.useReducer(It,{hoverIndex:0,valueIndex:0,ratingValue:a,hoverValue:null}),O=Se[0],j=O.ratingValue,f=O.hoverValue,U=O.hoverIndex,ke=O.valueIndex,H=Se[1];C.useEffect(function(){a&&H({type:"MouseClick",payload:0})},[a]);var R=C.useMemo(function(){return d?2*o:o},[d,o]),T=C.useMemo(function(){return a>R?0:d||Math.floor(a)===a?Math.round(a/o*100):2*Math.ceil(a)*10},[d,a,o,R]),ve=C.useMemo(function(){return(d?2*a-1:a-1)||0},[d,a]),N=C.useCallback(function(l){return o%2!=0?l/2/10:l*o/100},[o]),_e=function(l){for(var L=l.clientX,S=l.currentTarget.children[0].getBoundingClientRect(),ct=S.left,dt=S.right,ut=S.width,Re=w?dt-L:L-ct,E=R,Le=Math.round(ut/R),B=0;B<=R;B+=1)if(Re<=Le*B){E=B===0&&Re<Le?0:B;break}var Me=E-1;E>0&&(H({type:"PointerMove",payload:100*E/R,index:Me}),r&&f&&r(N(f),Me,l))},Ve=function(l){f&&(H({type:"MouseClick",payload:f}),s&&s(N(f),U,l))},lt=C.useMemo(function(){if(D){if(te){var l=j&&j||T;return f&&f>l?f:l}return f&&f||j&&j||T}return j&&j||T},[D,te,f,j,T]);C.useEffect(function(){W.length>R&&console.error("tooltipArray Array length is bigger then Icons Count length.")},[W.length,R]);var Pe=C.useCallback(function(l){return f&&l[U]||j&&l[ke]||a&&l[ve]},[f,U,j,ke,a,ve]),ze=C.useMemo(function(){return f&&N(f)||j&&N(j)||a&&N(T)},[f,N,j,a,T]);return k.jsxs("span",u({className:Tt,style:{direction:"".concat(w?"rtl":"ltr")}},{children:[k.jsxs("span",u({className:"".concat(Nt," ").concat(I),style:u({cursor:P?"":"pointer"},y),onPointerMove:P?void 0:_e,onPointerEnter:P?void 0:function(l){p&&p(l),Oe()&&_e(l)},onPointerLeave:P?void 0:function(l){Oe()&&Ve(),H({type:"PointerLeave"}),m&&m(l)},onClick:P?void 0:Ve,"aria-hidden":"true"},{children:[k.jsx("span",u({className:"".concat(At," ").concat(tt),style:u({color:De},et)},{children:Fe([],Array(o),!0).map(function(l,L){var S;return k.jsx(C.Fragment,{children:((S=x[L])===null||S===void 0?void 0:S.icon)||Ye||k.jsx(We,{SVGclassName:he,SVGstyle:xe,SVGstorkeWidth:ye,SVGstrokeColor:Ce,size:v})},L)})})),k.jsx("span",u({className:"".concat(Gt," ").concat($e),style:u((n={},n[w?"right":"left"]=0,n.color=Pe(Xe)||Qe,n.transition=Ue?"width .2s ease, color .2s ease":"",n.width="".concat(lt,"%"),n),Ze),title:ot?"".concat(ze," ").concat(at," ").concat(o):void 0},{children:Fe([],Array(o),!0).map(function(l,L){var S;return k.jsx(C.Fragment,{children:((S=x[L])===null||S===void 0?void 0:S.icon)||Je||k.jsx(We,{SVGclassName:he,SVGstyle:xe,SVGstorkeWidth:ye,SVGstrokeColor:Ce,size:v})},L)})}))]})),it&&k.jsx("span",u({className:"".concat(Bt," ").concat(st),style:u((c={},c[w?"marginRight":"marginLeft"]=20,c),rt)},{children:(W.length>0?Pe(W):ze)||nt}))]}))};function Ft(e){return pt({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"},child:[]}]})(e)}const Wt=({productId:e})=>{var G,w;const[n,c]=X.useState(0),{register:s,handleSubmit:r}=Vt(),p=mt(),{data:m}=Z("reviews",kt),{isLoading:V,mutate:a}=St(vt,{onSuccess:()=>{p.invalidateQueries({queryKey:["reviews"]})}}),{data:h}=Z("users",_t),o=gt.get("jwt"),g=i=>{c(i)},v=i=>{const x=new FormData;x.append("data",JSON.stringify({username:h==null?void 0:h.username,rating:n,review:i.review,user:h==null?void 0:h.id,product:e})),a({body:x})},F=(G=m==null?void 0:m.data)==null?void 0:G.some(i=>{var x,b,d,y;return((d=(b=(x=i==null?void 0:i.attributes)==null?void 0:x.product)==null?void 0:b.data)==null?void 0:d.id)===Number(e)&&((y=i==null?void 0:i.attributes)==null?void 0:y.username)===(h==null?void 0:h.username)}),P=He();return X.useEffect(()=>{var d;const i=(d=m==null?void 0:m.data)==null?void 0:d.filter(y=>{var z,I,A;return((A=(I=(z=y==null?void 0:y.attributes)==null?void 0:z.product)==null?void 0:I.data)==null?void 0:A.id)===Number(e)});if(!i||i.length===0){P(we(0));return}const b=i.reduce((y,z)=>y+z.attributes.rating,0)/i.length;P(we(b))},[P,e,m]),t.jsxs(t.Fragment,{children:[t.jsxs($,{fontSize:{base:"large",lg:"xx-large"},mb:"20px",position:"relative",display:"inline-block",children:["المراجعات",t.jsx(_,{position:"absolute",bottom:"-5px",left:"50%",transform:"translateX(-50%)",width:"100%",height:"3px",backgroundColor:"purple.600"})]}),o&&!F&&t.jsx(_,{as:"form",onSubmit:r(v),mb:"40px",children:t.jsxs(Ee,{children:[t.jsxs(Rt,{children:[t.jsx(Pt,{children:"مراجعة المنتج"}),t.jsx(zt,{placeholder:"مراجعة المنتج",...s("review",{required:"This field is required"}),borderColor:"purple.600",_hover:{borderColor:"purple.800"}})]}),t.jsx(_,{children:t.jsx(Ke,{onClick:g,ratingValue:n,rtl:!0,transition:!0,iconsCount:5,titleSeparator:"من",SVGstyle:{display:"inline-block"}})}),t.jsx(ht,{type:"submit",backgroundColor:"purple.600",color:"white",size:"large",p:"5",_hover:{backgroundColor:"purple.800"},isLoading:V,children:"مراجعة"})]})}),t.jsx(ft,{flexDirection:"column",gap:"3",children:(w=m==null?void 0:m.data)==null?void 0:w.filter(i=>{var x,b,d;return((d=(b=(x=i==null?void 0:i.attributes)==null?void 0:x.product)==null?void 0:b.data)==null?void 0:d.id)===Number(e)}).map(i=>{var x,b,d,y;return t.jsxs(_,{borderWidth:"1px",borderRadius:"md",borderColor:"purple.600",boxShadow:"xl",p:"4",children:[t.jsx($,{as:"h3",mb:"4px",children:(x=i==null?void 0:i.attributes)==null?void 0:x.username}),t.jsxs(M,{display:"inline-block",mb:"4px",children:["التقييم:",(b=i==null?void 0:i.attributes)==null?void 0:b.rating,t.jsx(M,{as:"span",display:"flex",gap:"1",children:[...Array((d=i==null?void 0:i.attributes)==null?void 0:d.rating)].map((z,I)=>t.jsx(Ft,{color:"gold"},I))})]}),t.jsx(M,{children:(y=i==null?void 0:i.attributes)==null?void 0:y.review})]},i.id)})})]})};function lo(){const{id:e}=xt(),n=He(),c=J(g=>g.cart),s=J(g=>g.wishlist),r=J(g=>g.compare),p=bt(),m=()=>{const g=c.cart.find(v=>v.id===o.id);!g&&(n(yt(o)),p({title:"المنتج تمت اضافته الى عربة التسوق بنجاح",status:"success",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(Ne,{size:20})})),g&&p({title:" المنتج موجود بالفعل في عربة التسوق",status:"warning",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(K,{size:20})})},V=()=>{const g=s.wishlist.find(v=>v.id===o.id);!g&&(n(jt(o)),p({title:" المنتج تمت اضافته الى قائمة الرغبات بنجاح",status:"success",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(Ge,{size:20})})),g&&p({title:"المنتج موجود بالفعل في قائمة الرغبات",status:"warning",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(K,{size:20})})},a=()=>{r.compare.find(v=>v.id===o.id)?p({title:" المنتج موجود بالفعل في المقارنات ",status:"warning",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(K,{size:20})}):r.compare.length<3?(n(Ct(o)),p({title:" المنتج تمت اضافته الى المقارنات بنجاح",status:"success",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(Ae,{size:20})})):p({title:"لا يمكن اضافة المنتج، يمكنك المقارنة بين 3 منتجات فقط",status:"warning",duration:3e3,isClosable:!0,position:"top-right",icon:t.jsx(K,{size:20})})},{isLoading:h,data:o}=Z(["product",e],()=>Lt(e));return h?t.jsx(wt,{}):t.jsxs(_,{m:30,children:[t.jsxs(_,{children:[t.jsxs($,{fontSize:{base:"large",lg:"xx-large"},mb:"20px",position:"relative",display:"inline-block",children:[o==null?void 0:o.title,t.jsx(_,{position:"absolute",bottom:"-5px",left:"50%",transform:"translateX(-50%)",width:"100%",height:"3px",backgroundColor:"purple.600"})]}),t.jsx(_,{borderWidth:"1px",borderRadius:"md",borderColor:"purple.600",rounded:"lg",boxShadow:"xl",mb:"4",children:t.jsxs(Be,{spacing:"4",justifyContent:"space-between",gap:4,flexDirection:{base:"column",lg:"row"},children:[t.jsx(Mt,{src:o==null?void 0:o.thumbnail,alt:o.title,width:"100%",objectFit:"fill",rounded:"lg",roundedBottom:{base:"none",lg:"lg"},roundedLeft:{base:"lg",lg:"none"},flexBasis:"50%"}),t.jsxs(Ee,{align:"start",justify:"center",spacing:"4",flexBasis:"50%",p:"20px",children:[t.jsx(M,{fontSize:{base:"md",md:"lg"},mt:"2",color:"gray.400",children:o.description}),o.discountPercentage>0?t.jsxs(M,{fontSize:"lg",fontWeight:"semibold",children:["تخفيض : ",`${Math.ceil(o.discountPercentage)} %`]}):null,t.jsxs(_,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",children:[t.jsx(M,{fontSize:"large",fontWeight:"semibold",textDecoration:o.discountPercentage?"line-through":"none",children:Ie(o.price)}),t.jsx(M,{fontSize:"large",fontWeight:"semibold",children:Ie(o.price-o.price*(o.discountPercentage/100))})]}),t.jsxs(M,{fontSize:"md",children:["عدد القطع المتوفرة :",o.stock]}),t.jsxs(Be,{spacing:"2",flexDirection:"row",children:[t.jsx(Q,{backgroundColor:"purple.600",color:"white",size:"lg",_hover:{backgroundColor:"purple.800"},onClick:m,"aria-label":"اضافة الى العربة",icon:t.jsx(Ne,{})}),t.jsx(Q,{backgroundColor:"purple.600",color:"white",size:"lg",_hover:{backgroundColor:"purple.800"},onClick:V,"aria-label":"اضافة الى المفضلة",icon:t.jsx(Ge,{})}),t.jsx(Q,{backgroundColor:"purple.600",color:"white",size:"lg",_hover:{backgroundColor:"purple.800"},icon:t.jsx(Ae,{size:"20"}),onClick:a})]})]})]})})]}),t.jsx(Wt,{productId:e})]})}export{lo as default};
